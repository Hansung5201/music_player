<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Collaborative Music Player</title>
    <link rel="stylesheet" href="/static/dashboard.css" />
  </head>
  <body>
    <header>
      <h1>Collaborative Music Player</h1>
      <p>
        Use this dashboard to log in as a host or guest, create or join sessions,
        manage the playlist, and observe playback synchronization events in real
        time.
      </p>
    </header>

    <main>
      <section class="panel role-chooser">
        <h2>Pick a console</h2>
        <p class="help-text">
          Choose the workflow that matches your task. Selecting a console will
          pre-fill the authentication form and surface the right controls for the
          role.
        </p>
        <div class="role-grid">
          <button
            type="button"
            class="role-card"
            data-role-select="host"
            id="host-card"
          >
            <div class="role-card__header">
              <div>
                <span class="role-label">Host console</span>
                <p class="role-subtitle">
                  Create sessions, curate the playlist, and steer playback.
                </p>
              </div>
              <span class="role-chip">Lead</span>
            </div>
            <ul>
              <li>Generate a host token and create invite codes.</li>
              <li>Approve or reject playlist requests.</li>
              <li>Send live playback commands or broadcast WebSocket events.</li>
            </ul>
            <dl class="role-stats">
              <div>
                <dt>Status</dt>
                <dd id="host-status">Not authenticated</dd>
              </div>
              <div>
                <dt>Session</dt>
                <dd id="host-session-chip">No session</dd>
              </div>
              <div>
                <dt>Token</dt>
                <dd id="host-token-chip">Tap card &amp; login</dd>
              </div>
            </dl>
          </button>
          <button
            type="button"
            class="role-card"
            data-role-select="guest"
            id="guest-card"
          >
            <div class="role-card__header">
              <div>
                <span class="role-label">Guest console</span>
                <p class="role-subtitle">
                  Join a session, drop requests, and stay synced with playback.
                </p>
              </div>
              <span class="role-chip role-chip--accent">Join</span>
            </div>
            <ul>
              <li>Request songs and vote on the running order.</li>
              <li>Watch the playlist update in real time.</li>
              <li>Mirror playback state through the WebSocket channel.</li>
            </ul>
            <dl class="role-stats">
              <div>
                <dt>Status</dt>
                <dd id="guest-status">Not authenticated</dd>
              </div>
              <div>
                <dt>Session</dt>
                <dd id="guest-session-chip">No session</dd>
              </div>
              <div>
                <dt>Token</dt>
                <dd id="guest-token-chip">Tap card &amp; login</dd>
              </div>
            </dl>
          </button>
        </div>
      </section>

      <section class="panel">
        <h2>1. Authenticate</h2>
        <form id="login-form" class="stacked">
          <label>
            Display name
            <input type="text" name="name" placeholder="DJ Pixel" required />
          </label>
          <input type="hidden" name="role" id="role-input" value="host" />
          <p class="help-text">
            Currently preparing the <strong id="selected-role-copy">Host console</strong>.
            Switch cards above to toggle roles before logging in.
          </p>
          <button type="submit">Generate token</button>
        </form>
        <p class="help-text">
          Tokens are ephemeral and scoped to the selected role. Copy/paste them
          for API calls if you prefer using cURL or Postman.
        </p>
        <pre id="token-display" class="token-display">Token will appear here.</pre>
      </section>

      <section class="panel">
        <h2>2. Session Lifecycle</h2>
        <div class="two-column">
          <fieldset id="host-session" disabled>
            <legend>Create session (host)</legend>
            <form id="create-session-form" class="stacked">
              <label>
                Session title
                <input type="text" name="host_name" placeholder="Friday Jam" required />
              </label>
              <label>
                Max track length (seconds)
                <input
                  type="number"
                  name="max_media_duration_seconds"
                  min="10"
                  step="5"
                  placeholder="300"
                />
              </label>
              <p class="help-text">Leave blank for unlimited uploads.</p>
              <button type="submit">Create session</button>
            </form>
          </fieldset>
          <fieldset id="guest-session" disabled>
            <legend>Join session (guest)</legend>
            <form id="join-session-form" class="stacked">
              <label>
                Invite code
                <input type="text" name="code" placeholder="ABC123" required />
              </label>
              <label>
                Display name
                <input type="text" name="guest_name" placeholder="Synth Cat" required />
              </label>
              <button type="submit">Join session</button>
            </form>
          </fieldset>
        </div>
        <div class="status-grid">
          <div>
            <h3>Session ID</h3>
            <p id="session-id">-</p>
          </div>
          <div>
            <h3>Invite code</h3>
            <p id="invite-code">-</p>
          </div>
          <div>
            <h3>Role</h3>
            <p id="role-display">-</p>
          </div>
          <div>
            <h3>WebSocket</h3>
            <p id="ws-status">Disconnected</p>
          </div>
        </div>
        <button id="connect-ws" class="primary" disabled>Connect WebSocket</button>
      </section>

      <section class="panel">
        <h2>3. Playlist & Playback</h2>
        <div class="two-column">
          <fieldset id="playlist-actions" disabled>
            <legend>Playlist actions</legend>
            <form id="add-track-form" class="stacked">
              <label>
                Track ID
                <input type="text" name="track_id" placeholder="track-123" required />
              </label>
              <label>
                Track name
                <input type="text" name="name" placeholder="Future Funk" required />
              </label>
              <label class="file-picker">
                Upload media
                <input
                  type="file"
                  id="media-file-input"
                  name="media_file"
                  accept="audio/mpeg,video/mp4,.mp3,.mp4"
                  required
                />
              </label>
              <input type="hidden" name="duration_seconds" id="duration-seconds-input" />
              <p class="help-text" id="detected-duration-copy">
                Select a file to auto-detect its runtime.
              </p>
              <p class="help-text">
                Max allowed length: <strong id="max-duration-copy">No limit</strong>
              </p>
              <button type="submit">Add track</button>
            </form>
            <form id="guest-request-form" class="stacked">
              <label>
                Request payload (JSON)
                <textarea name="payload" rows="4" placeholder='{"request_type":"add","payload":{"track_id":"t42","title":"Song","artist":"Artist"}}'></textarea>
              </label>
              <button type="submit">Submit custom request</button>
            </form>
          </fieldset>
          <fieldset id="playback-actions" disabled>
            <legend>Playback commands (host)</legend>
            <form id="playback-form" class="stacked">
              <label>
                Action
                <select name="action">
                  <option value="play">Play</option>
                  <option value="pause">Pause</option>
                  <option value="seek">Seek</option>
                  <option value="skip_next">Skip Next</option>
                  <option value="skip_prev">Skip Previous</option>
                </select>
              </label>
              <label>
                Track ID (optional)
                <input type="text" name="track_id" placeholder="track-123" />
              </label>
              <label>
                Position (ms)
                <input type="number" name="position_ms" min="0" step="100" />
              </label>
              <button type="submit">Send command</button>
            </form>
          </fieldset>
        </div>
        <div class="player-wrapper">
          <div class="player-card" id="player-shell">
            <div class="player-card__header">
              <div>
                <p class="player-label">Now playing</p>
                <h3 id="player-track-name">Upload a track to begin</h3>
                <p id="player-track-meta" class="player-meta">No track loaded</p>
              </div>
              <span class="player-duration-chip" id="player-duration-chip">--</span>
            </div>
            <div class="player-controls">
              <button type="button" class="icon-button" id="player-prev" aria-label="Previous track">
                ⏮
              </button>
              <button type="button" class="icon-button" id="player-play" aria-label="Play">
                ▶️
              </button>
              <button type="button" class="icon-button" id="player-pause" aria-label="Pause">
                ⏸
              </button>
              <button type="button" class="icon-button" id="player-next" aria-label="Next track">
                ⏭
              </button>
            </div>
            <div class="player-progress">
              <span id="player-current-time">0:00</span>
              <input type="range" id="player-seek" min="0" max="0" value="0" />
              <span id="player-duration">0:00</span>
            </div>
          </div>
          <audio id="media-player" class="sr-only" preload="metadata"></audio>
        </div>
        <div class="data-grid">
          <div>
            <h3>Playlist</h3>
            <table>
              <thead>
                <tr>
                  <th>#</th>
                  <th>Track</th>
                  <th>Duration</th>
                  <th>Type</th>
                </tr>
              </thead>
              <tbody id="playlist-body"></tbody>
            </table>
          </div>
          <div>
            <h3>Requests</h3>
            <ul id="request-list" class="request-list"></ul>
          </div>
          <div>
            <h3>Playback state</h3>
            <dl id="playback-state" class="playback-state">
              <div>
                <dt>Track</dt>
                <dd>-</dd>
              </div>
              <div>
                <dt>Position</dt>
                <dd>-</dd>
              </div>
              <div>
                <dt>Status</dt>
                <dd>-</dd>
              </div>
              <div>
                <dt>Updated</dt>
                <dd>-</dd>
              </div>
            </dl>
          </div>
        </div>
      </section>

      <section class="panel">
        <h2>4. Activity log</h2>
        <pre id="activity-log" class="activity-log">Waiting for events...</pre>
      </section>
    </main>

    <div id="status-banner" class="banner">Ready.</div>

    <script src="/static/dashboard.js" defer></script>
  </body>
</html>
